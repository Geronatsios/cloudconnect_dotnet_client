@model IEnumerable<MD.CloudConnect.CouchBaseProvider.Track>
    @{
        ViewBag.Title = "Tracking Raw data";
    }
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <div class="page-header">
                    @if (String.IsNullOrEmpty(@ViewBag.Imei))
                    {
                        <div class="alert alert-danger">
                            This asset does not exist !
                        </div>
                    }
                    else
                    {
                        <h1>
                            Tracking Data for @ViewBag.Imei <small>@(ViewBag.Date > DateTime.MinValue ? ViewBag.Date.ToString("yyyy/MM/dd") : "")</small>
                        </h1>

                        if (ViewBag.Date > DateTime.MinValue)
                        {
                            <a class="btn btn-primary" href="@Url.Action("Index", new { asset = ViewBag.Imei, year = ViewBag.Date.AddDays(-1).Year, month = ViewBag.Date.AddDays(-1).Month, Day = ViewBag.Date.AddDays(-1).Day })">
                                <i class='icon-arrow-left icon-white'></i>Previous Day
                            </a>
                        }
                        if (ViewBag.Date < DateTime.Today)
                        {
                            <a class="btn btn-primary" href="@Url.Action("Index", new { asset = ViewBag.Imei, year = ViewBag.Date.AddDays(1).Year, month = ViewBag.Date.AddDays(1).Month, Day = ViewBag.Date.AddDays(1).Day })">
                                Next Day <i class='icon-arrow-right icon-white'></i>
                            </a>
                        }

                        <a class="btn btn-success" href="@Url.Action("csvexport", new { asset = ViewBag.Imei, datekey = ViewBag.DateKey })">
                            <i class='icon-download-alt icon-white'></i>Export to Csv
                        </a>

                    }
                </div>
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <thead>
                        <tr>
                            @if (ViewBag.DebugOn == true)
                            {
                                <th>
                                    Cloud Id
                                </th>
                                <th>
                                    Conn. Id
                                </th>
                                <th>
                                    Index
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Created At
                                </th>
                                <th>
                                    Updated At
                                </th>
                            }
                            @if (ViewBag.ServerDate == true)
                            {
                                <th>
                                    Received at (cloud)
                                </th>
                            }

                            <th>
                                Recorded_at
                            </th>
                            <th>
                                Longitude
                            </th>
                            <th>
                                Latitude
                            </th>
                            @foreach (string item in ViewBag.Fields)
                            {
                                <th>
                                    @item
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @{ var arrayModel = Model.ToArray(); }
                        @for (int i = 0; i < arrayModel.Length; i++)
                        {
                            var item = arrayModel[i];

                            if (item.Status != MD.CloudConnect.CouchBaseProvider.Track.OK_REBUILDED && item.Status != MD.CloudConnect.CouchBaseProvider.Track.DATA_FEED_REBUILDED)
                            {
                                <tr class="danger">
                                    @if (ViewBag.DebugOn == true)
                                    {
                                        <td>
                                            @item.CloudId
                                        </td>
                                        <td>
                                            @item.ConnectionId
                                        </td>
                                        <td>
                                            @item.Index
                                        </td>
                                        <td>
                                            @item.Status
                                        </td>
                                        <td>
                                            @item.Created_at.ToString("MM/dd HH:mm:ss.fff")
                                        </td>
                                        <td>
                                            @item.Updated_at.ToString("MM/dd HH:mm:ss.fff")
                                        </td>
                                    }
                                    <td>
                                        @item.Recorded_at.ToString("HH:mm:ss.fff")
                                    </td>
                                    <td>
                                        @item.Longitude.ToString(System.Globalization.CultureInfo.InvariantCulture)
                                    </td>
                                    <td>
                                        @item.Latitude.ToString(System.Globalization.CultureInfo.InvariantCulture)
                                    </td>
                                    @foreach (string key in ViewBag.Fields)
                                    {
                                        <td>
                                            @WebDemo.Models.FieldHelper.GetDisplayDataFor(key, item.Fields, (i < arrayModel.Length - 1 ? arrayModel[i + 1].Fields : null))
                                        </td>
                                    }
                                </tr>
                            }
                            else
                            {
                                <tr>
                                    @if (ViewBag.DebugOn == true)
                                    {
                                        <td>
                                            @item.CloudId
                                        </td>
                                        <td>
                                            @item.ConnectionId
                                        </td>
                                        <td>
                                            @item.Index
                                        </td>
                                        <td>
                                            @item.Status
                                        </td>
                                        <td>
                                            @item.Created_at.ToString("MM/dd HH:mm:ss.fff")
                                        </td>
                                        <td>
                                            @item.Updated_at.ToString("MM/dd HH:mm:ss.fff")
                                        </td>
                                    }
                                    @if (ViewBag.ServerDate == true)
                                    {
                                        <td>
                                            @item.Received_at.ToString("MM/dd HH:mm:ss.fff")
                                        </td>
                                    }

                                    <td>
                                        @item.Recorded_at.ToString("HH:mm:ss.fff")
                                    </td>
                                    <td>
                                        @item.Longitude.ToString(System.Globalization.CultureInfo.InvariantCulture)
                                    </td>
                                    <td>
                                        @item.Latitude.ToString(System.Globalization.CultureInfo.InvariantCulture)
                                    </td>
                                    @foreach (string key in ViewBag.Fields)
                                    {
                                        <td>
                                            @WebDemo.Models.FieldHelper.GetDisplayDataFor(key, item.Fields, (i < arrayModel.Length - 1 ? arrayModel[i + 1].Fields : null))
                                        </td>
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
